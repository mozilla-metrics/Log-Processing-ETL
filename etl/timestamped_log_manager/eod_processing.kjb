<?xml version="1.0" encoding="UTF-8"?>
<!-- The contents of this file are subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this file,
   - You can obtain one at http://mozilla.org/MPL/2.0/.  -->
<job>
  <name>eod_processing</name>
    <description/>
    <extended_description>
The contents of this file are subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this file,
You can obtain one at http:&#47;&#47;mozilla.org&#47;MPL&#47;2.0&#47;.
    </extended_description>
    <job_version/>
    <job_status>0</job_status>
  <directory>&#47;</directory>
  <created_user>-</created_user>
  <created_date>2010&#47;03&#47;10 17:06:21.241</created_date>
  <modified_user>-</modified_user>
  <modified_date>2010&#47;03&#47;10 17:06:21.241</modified_date>
    <parameters>
    </parameters>
  <connection>
    <name>metrics</name>
    <server>${VERTICA_HOST}</server>
    <type>VERTICA</type>
    <access>Native</access>
    <database>${VERTICA_DB}</database>
    <port>${VERTICA_PORT}</port>
    <username>${VERTICA_USER}</username>
    <password>${VERTICA_PASS}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${VERTICA_PORT}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SQL_CONNECT</code><attribute>SET SESSION CHARACTERISTICS AS TRANSACTION 
ISOLATION LEVEL READ COMMITTED</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>metrics mysql</name>
    <server>${METRICS_MYSQL_HOST}</server>
    <type>MYSQL</type>
    <access>Native</access>
    <database>${METRICS_MYSQL_NAME}</database>
    <port>${METRICS_MYSQL_PORT}</port>
    <username>${METRICS_MYSQL_USER}</username>
    <password>${METRICS_MYSQL_PASS}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>EXTRA_OPTION_MYSQL.characterEncoding</code><attribute>UTF-8</attribute></attribute>
      <attribute><code>EXTRA_OPTION_MYSQL.defaultFetchSize</code><attribute>500</attribute></attribute>
      <attribute><code>EXTRA_OPTION_MYSQL.useCursorFetch</code><attribute>true</attribute></attribute>
      <attribute><code>EXTRA_OPTION_MYSQL.useServerPrepStmts</code><attribute>true</attribute></attribute>
      <attribute><code>EXTRA_OPTION_MYSQL.useUnicode</code><attribute>true</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${METRICS_MYSQL_PORT}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>STREAM_RESULTS</code><attribute>N</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
    <slaveservers>
    </slaveservers>
<job-log-table><connection>metrics mysql</connection>
<schema/>
<table>log_job</table>
<size_limit_lines/>
<interval/>
<timeout_days/>
<field><id>ID_JOB</id><enabled>Y</enabled><name>ID_JOB</name></field><field><id>CHANNEL_ID</id><enabled>N</enabled><name>CHANNEL_ID</name></field><field><id>JOBNAME</id><enabled>Y</enabled><name>JOBNAME</name></field><field><id>STATUS</id><enabled>Y</enabled><name>STATUS</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name></field><field><id>LINES_REJECTED</id><enabled>N</enabled><name>LINES_REJECTED</name></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>STARTDATE</id><enabled>Y</enabled><name>STARTDATE</name></field><field><id>ENDDATE</id><enabled>Y</enabled><name>ENDDATE</name></field><field><id>LOGDATE</id><enabled>Y</enabled><name>LOGDATE</name></field><field><id>DEPDATE</id><enabled>Y</enabled><name>DEPDATE</name></field><field><id>REPLAYDATE</id><enabled>Y</enabled><name>REPLAYDATE</name></field><field><id>LOG_FIELD</id><enabled>Y</enabled><name>LOG_FIELD</name></field></job-log-table>
<jobentry-log-table><connection/>
<schema/>
<table/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>LOG_DATE</id><enabled>Y</enabled><name>LOG_DATE</name></field><field><id>JOBNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>JOBENTRYNAME</id><enabled>Y</enabled><name>STEPNAME</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>RESULT</id><enabled>Y</enabled><name>RESULT</name></field><field><id>NR_RESULT_ROWS</id><enabled>Y</enabled><name>NR_RESULT_ROWS</name></field><field><id>NR_RESULT_FILES</id><enabled>Y</enabled><name>NR_RESULT_FILES</name></field><field><id>LOG_FIELD</id><enabled>N</enabled><name>LOG_FIELD</name></field><field><id>COPY_NR</id><enabled>N</enabled><name>COPY_NR</name></field></jobentry-log-table>
<channel-log-table><connection/>
<schema/>
<table/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>LOG_DATE</id><enabled>Y</enabled><name>LOG_DATE</name></field><field><id>LOGGING_OBJECT_TYPE</id><enabled>Y</enabled><name>LOGGING_OBJECT_TYPE</name></field><field><id>OBJECT_NAME</id><enabled>Y</enabled><name>OBJECT_NAME</name></field><field><id>OBJECT_COPY</id><enabled>Y</enabled><name>OBJECT_COPY</name></field><field><id>REPOSITORY_DIRECTORY</id><enabled>Y</enabled><name>REPOSITORY_DIRECTORY</name></field><field><id>FILENAME</id><enabled>Y</enabled><name>FILENAME</name></field><field><id>OBJECT_ID</id><enabled>Y</enabled><name>OBJECT_ID</name></field><field><id>OBJECT_REVISION</id><enabled>Y</enabled><name>OBJECT_REVISION</name></field><field><id>PARENT_CHANNEL_ID</id><enabled>Y</enabled><name>PARENT_CHANNEL_ID</name></field><field><id>ROOT_CHANNEL_ID</id><enabled>Y</enabled><name>ROOT_CHANNEL_ID</name></field></channel-log-table>
   <pass_batchid>Y</pass_batchid>
   <shared_objects_file/>
  <entries>
    <entry>
      <name>START</name>
      <description>Special entries</description>
      <type>SPECIAL</type>
      <start>Y</start>
      <dummy>N</dummy>
      <repeat>N</repeat>
      <schedulerType>0</schedulerType>
      <intervalSeconds>0</intervalSeconds>
      <intervalMinutes>60</intervalMinutes>
      <hour>12</hour>
      <minutes>0</minutes>
      <weekDay>1</weekDay>
      <DayOfMonth>1</DayOfMonth>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>50</xloc>
      <yloc>50</yloc>
      </entry>
    <entry>
      <name>Run daily aggregates</name>
      <description>Job</description>
      <type>JOB</type>
      <specification_method>filename</specification_method>
      <job_object_id/>
      <filename>${Internal.Job.Filename.Directory}&#47;run_daily_aggregates.kjb</filename>
      <jobname/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <set_logfile>Y</set_logfile>
      <logfile>&#47;etl&#47;logs&#47;eod_rollup</logfile>
      <logext>log</logext>
      <add_date>Y</add_date>
      <add_time>Y</add_time>
      <loglevel>Minimal</loglevel>
      <slave_server_name/>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <pass_export>N</pass_export>
      <parameters>        <pass_all_parameters>Y</pass_all_parameters>
      </parameters>      <set_append_logfile>N</set_append_logfile>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>650</xloc>
      <yloc>50</yloc>
      </entry>
    <entry>
      <name>Run Vertica GAH</name>
      <description>Job</description>
      <type>JOB</type>
      <specification_method>filename</specification_method>
      <job_object_id/>
      <filename>&#47;etl&#47;gah_vertica&#47;kettle&#47;GenericAggHandler.kjb</filename>
      <jobname/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <set_logfile>Y</set_logfile>
      <logfile>&#47;etl&#47;logs&#47;eod_gah</logfile>
      <logext>log</logext>
      <add_date>Y</add_date>
      <add_time>Y</add_time>
      <loglevel>Minimal</loglevel>
      <slave_server_name/>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <pass_export>N</pass_export>
      <parameters>        <pass_all_parameters>Y</pass_all_parameters>
      </parameters>      <set_append_logfile>N</set_append_logfile>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>850</xloc>
      <yloc>100</yloc>
      </entry>
    <entry>
      <name>Export to Socorro</name>
      <description>Transformation</description>
      <type>TRANS</type>
      <specification_method>filename</specification_method>
      <trans_object_id/>
      <filename>&#47;etl&#47;socorro&#47;extract_adu.ktr</filename>
      <transname/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <clear_rows>N</clear_rows>
      <clear_files>N</clear_files>
      <set_logfile>Y</set_logfile>
      <logfile>&#47;etl&#47;logs&#47;eod_socorro</logfile>
      <logext>log</logext>
      <add_date>Y</add_date>
      <add_time>Y</add_time>
      <loglevel>Minimal</loglevel>
      <cluster>N</cluster>
      <slave_server_name/>
      <set_append_logfile>N</set_append_logfile>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <parameters>        <pass_all_parameters>Y</pass_all_parameters>
            <parameter>            <name>SOCORRO_DB_HOST</name>
            <stream_name/>
            <value>FIXME</value>
            </parameter>            <parameter>            <name>SOCORRO_DB_USER</name>
            <stream_name/>
            <value>FIXME</value>
            </parameter>            <parameter>            <name>SOCORRO_DB_PASS</name>
            <stream_name/>
            <value>FIXME</value>
            </parameter>            <parameter>            <name>DATE</name>
            <stream_name/>
            <value>= &apos;${PREVIOUS_UTC_DATE}&apos;</value>
            </parameter>      </parameters>      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>850</xloc>
      <yloc>200</yloc>
      </entry>
    <entry>
      <name>export_daily_amo_stats</name>
      <description>Job</description>
      <type>JOB</type>
      <specification_method>filename</specification_method>
      <job_object_id/>
      <filename>&#47;etl&#47;amo&#47;export_daily_amo_stats.kjb</filename>
      <jobname/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <set_logfile>Y</set_logfile>
      <logfile>&#47;etl&#47;logs&#47;eod_amo</logfile>
      <logext>log</logext>
      <add_date>Y</add_date>
      <add_time>Y</add_time>
      <loglevel>Minimal</loglevel>
      <slave_server_name/>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <pass_export>N</pass_export>
      <parameters>        <pass_all_parameters>Y</pass_all_parameters>
            <parameter>            <name>DATE</name>
            <stream_name/>
            <value>= &apos;${PREVIOUS_UTC_DATE}&apos;</value>
            </parameter>      </parameters>      <set_append_logfile>N</set_append_logfile>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>850</xloc>
      <yloc>150</yloc>
      </entry>
    <entry>
      <name>Abort if error</name>
      <description>Abort job</description>
      <type>ABORT</type>
      <message>An error occured during EOD processing</message>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>650</xloc>
      <yloc>250</yloc>
      </entry>
    <entry>
      <name>Mail error condition</name>
      <description>Mail</description>
      <type>MAIL</type>
      <server>localhost</server>
      <port>25</port>
      <destination>metrics-alerts@mozilla.org</destination>
      <destinationCc/>
      <destinationBCc/>
      <replyto>metrics-alerts@mozilla.org</replyto>
      <replytoname>Metrics EOD processor</replytoname>
      <subject>Error during EOD processing</subject>
      <include_date>N</include_date>
      <contact_person>Daniel Einspanjer</contact_person>
      <contact_phone>(603) 438-5731</contact_phone>
      <comment>One of the EOD processing scripts returned an error status.
Please check the logs and fix the problem then re-run the EOD processor.

This will delay the nightly reports and the exports of data to the Socorro and AMO production sites.
</comment>
      <include_files>Y</include_files>
      <zip_files>Y</zip_files>
      <zip_name>run_logs.zip</zip_name>
      <use_auth>N</use_auth>
      <use_secure_auth>N</use_secure_auth>
      <auth_user/>
      <auth_password>Encrypted </auth_password>
      <only_comment>Y</only_comment>
      <use_HTML>N</use_HTML>
      <use_Priority>Y</use_Priority>
      <encoding>UTF-8</encoding>
      <priority>high</priority>
      <importance>high</importance>
      <secureconnectiontype>SSL</secureconnectiontype>
      <replyToAddresses/>
      <filetypes>        <filetype>LOG</filetype>
      </filetypes>      <embeddedimages>
      </embeddedimages>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>550</xloc>
      <yloc>150</yloc>
      </entry>
    <entry>
      <name>Set Successful flag for EOD</name>
      <description>SQL</description>
      <type>SQL</type>
      <sql>REPLACE INTO eod_status SET `utc_date_string` = &apos;${PREVIOUS_UTC_DATE}&apos;, `status` = &apos;Successful&apos;, `audit_snapshot` = (
	SELECT CONCAT(site,&apos;\t&apos;,servers,&apos;\t&apos;,timestamps) AS results
	FROM (
		SELECT
		  site
		, GROUP_CONCAT(server ORDER BY server SEPARATOR &apos;, &apos;) AS servers
		, timestamps
		FROM (
			SELECT
			  site
			, CONCAT(datacenter,&apos;-&apos;,server) AS server
			, GROUP_CONCAT(timestamp ORDER BY timestamp SEPARATOR &apos;, &apos;) AS timestamps
			FROM `server_timestamps_to_process`
			WHERE required = &apos;Y&apos;
			GROUP BY 1,2
		) a
		GROUP BY 1,3
	) b
	ORDER BY site, timestamps
	LIMIT 1
);</sql>
      <useVariableSubstitution>T</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename/>
      <sendOneStatement>F</sendOneStatement>
      <connection>metrics mysql</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>1000</xloc>
      <yloc>100</yloc>
      </entry>
    <entry>
      <name>Set Failed flag for EOD</name>
      <description>SQL</description>
      <type>SQL</type>
      <sql>REPLACE INTO eod_status SET `utc_date_string` = &apos;${PREVIOUS_UTC_DATE}&apos;, `status` = &apos;Failed&apos;, `audit_snapshot` = (
	SELECT CONCAT(site,&apos;\t&apos;,servers,&apos;\t&apos;,timestamps) AS results
	FROM (
		SELECT
		  site
		, GROUP_CONCAT(server ORDER BY server SEPARATOR &apos;, &apos;) AS servers
		, timestamps
		FROM (
			SELECT
			  site
			, CONCAT(datacenter,&apos;-&apos;,server) AS server
			, GROUP_CONCAT(timestamp ORDER BY timestamp SEPARATOR &apos;, &apos;) AS timestamps
			FROM `server_timestamps_to_process`
			WHERE required = &apos;Y&apos;
			GROUP BY 1,2
		) a
		GROUP BY 1,3
	) b
	ORDER BY site, timestamps
	LIMIT 1
);</sql>
      <useVariableSubstitution>T</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename/>
      <sendOneStatement>F</sendOneStatement>
      <connection>metrics mysql</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>550</xloc>
      <yloc>250</yloc>
      </entry>
    <entry>
      <name>Set Running flag for EOD</name>
      <description>SQL</description>
      <type>SQL</type>
      <sql>REPLACE INTO eod_status SET `utc_date_string` = &apos;${PREVIOUS_UTC_DATE}&apos;, `status` = &apos;Running&apos;</sql>
      <useVariableSubstitution>T</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename/>
      <sendOneStatement>F</sendOneStatement>
      <connection>metrics mysql</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>150</xloc>
      <yloc>150</yloc>
      </entry>
    <entry>
      <name>Already has successful eod?</name>
      <description>Evaluate rows number in a table</description>
      <type>EVAL_TABLE_CONTENT</type>
      <connection>metrics mysql</connection>
      <schemaname/>
      <tablename>eod_status</tablename>
      <success_condition>rows_count_greater</success_condition>
      <limit>0</limit>
      <is_custom_sql>Y</is_custom_sql>
      <is_usevars>Y</is_usevars>
      <custom_sql>SELECT *
FROM eod_status
WHERE utc_date_string = &apos;${PREVIOUS_UTC_DATE}&apos;
AND status = &apos;Successful&apos;</custom_sql>
      <add_rows_result>N</add_rows_result>
      <clear_result_rows>Y</clear_result_rows>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>50</xloc>
      <yloc>250</yloc>
      </entry>
    <entry>
      <name>Success 1</name>
      <description>Success</description>
      <type>SUCCESS</type>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>150</xloc>
      <yloc>250</yloc>
      </entry>
    <entry>
      <name>audit_server_traffic</name>
      <description>Transformation</description>
      <type>TRANS</type>
      <specification_method>filename</specification_method>
      <trans_object_id/>
      <filename>${Internal.Job.Filename.Directory}&#47;audit_server_traffic.ktr</filename>
      <transname/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <clear_rows>N</clear_rows>
      <clear_files>N</clear_files>
      <set_logfile>Y</set_logfile>
      <logfile>&#47;etl&#47;logs&#47;eod_audit</logfile>
      <logext>log</logext>
      <add_date>Y</add_date>
      <add_time>Y</add_time>
      <loglevel>Minimal</loglevel>
      <cluster>N</cluster>
      <slave_server_name/>
      <set_append_logfile>N</set_append_logfile>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <parameters>        <pass_all_parameters>Y</pass_all_parameters>
      </parameters>      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>150</xloc>
      <yloc>50</yloc>
      </entry>
    <entry>
      <name>Mail missing logs</name>
      <description>Mail</description>
      <type>MAIL</type>
      <server>localhost</server>
      <port>25</port>
      <destination>metrics-alerts@mozilla.org</destination>
      <destinationCc/>
      <destinationBCc/>
      <replyto>metrics-alerts@mozilla.org</replyto>
      <replytoname>Metrics EOD processor</replytoname>
      <subject>Missing logs alert</subject>
      <include_date>N</include_date>
      <contact_person>Daniel Einspanjer</contact_person>
      <contact_phone>(603) 438-5731</contact_phone>
      <comment>The ETL processor was unable to find log files with valid data for the following servers and times.
Please check log file synchronization processes.  The processor will pick up new files on the next run.

These missing logs are currently preventing the End Of Day processing from succeeding.
This will delay the nightly reports and the exports of data to the Socorro and AMO production sites.


</comment>
      <include_files>N</include_files>
      <zip_files>N</zip_files>
      <zip_name/>
      <use_auth>N</use_auth>
      <use_secure_auth>N</use_secure_auth>
      <auth_user/>
      <auth_password>Encrypted </auth_password>
      <only_comment>Y</only_comment>
      <use_HTML>N</use_HTML>
      <use_Priority>Y</use_Priority>
      <encoding>UTF-8</encoding>
      <priority>high</priority>
      <importance>high</importance>
      <secureconnectiontype>SSL</secureconnectiontype>
      <replyToAddresses/>
      <filetypes>        <filetype>WARNING</filetype>
      </filetypes>      <embeddedimages>
      </embeddedimages>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>250</xloc>
      <yloc>250</yloc>
      </entry>
    <entry>
      <name>Run dimension update</name>
      <description>Job</description>
      <type>JOB</type>
      <specification_method>filename</specification_method>
      <job_object_id/>
      <filename>&#47;etl&#47;dimensions&#47;update.kjb</filename>
      <jobname/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <set_logfile>Y</set_logfile>
      <logfile>&#47;etl&#47;logs&#47;eod_dimensions</logfile>
      <logext>log</logext>
      <add_date>Y</add_date>
      <add_time>Y</add_time>
      <loglevel>Minimal</loglevel>
      <slave_server_name/>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <pass_export>N</pass_export>
      <parameters>        <pass_all_parameters>Y</pass_all_parameters>
      </parameters>      <set_append_logfile>N</set_append_logfile>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>550</xloc>
      <yloc>50</yloc>
      </entry>
    <entry>
      <name>Mail success</name>
      <description>Mail</description>
      <type>MAIL</type>
      <server>localhost</server>
      <port>25</port>
      <destination>metrics-alerts@mozilla.org</destination>
      <destinationCc/>
      <destinationBCc/>
      <replyto>metrics-alerts@mozilla.org</replyto>
      <replytoname>Metrics EOD processor</replytoname>
      <subject>EOD processing succeeded for ${PREVIOUS_UTC_DATE}</subject>
      <include_date>N</include_date>
      <contact_person>Daniel Einspanjer</contact_person>
      <contact_phone>(603) 438-5731</contact_phone>
      <comment/>
      <include_files>N</include_files>
      <zip_files>N</zip_files>
      <zip_name/>
      <use_auth>N</use_auth>
      <use_secure_auth>N</use_secure_auth>
      <auth_user/>
      <auth_password>Encrypted </auth_password>
      <only_comment>Y</only_comment>
      <use_HTML>N</use_HTML>
      <use_Priority>N</use_Priority>
      <encoding>UTF-8</encoding>
      <priority>normal</priority>
      <importance>normal</importance>
      <secureconnectiontype>SSL</secureconnectiontype>
      <replyToAddresses/>
      <filetypes>        <filetype>WARNING</filetype>
      </filetypes>      <embeddedimages>
      </embeddedimages>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>1000</xloc>
      <yloc>200</yloc>
      </entry>
    <entry>
      <name>Wait for no required</name>
      <description>Wait for SQL</description>
      <type>WAIT_FOR_SQL</type>
      <connection>metrics mysql</connection>
      <schemaname/>
      <tablename/>
      <success_condition>rows_count_equal</success_condition>
      <rows_count_value>0</rows_count_value>
      <is_custom_sql>Y</is_custom_sql>
      <is_usevars>Y</is_usevars>
      <custom_sql>SELECT DISTINCT
  s.datacenter
, s.site
, s.server
, timestamp
FROM server_timestamps_to_process sttp
JOIN servers s ON sttp.site = s.site AND sttp.server = s.server
WHERE active = &apos;Y&apos; AND timestamp &lt;= &apos;${EOD_LAST_HOUR}&apos;
ORDER BY 1,2,3,4</custom_sql>
      <add_rows_result>N</add_rows_result>
      <maximum_timeout>2700</maximum_timeout>
      <check_cycle_time>300</check_cycle_time>
      <success_on_timeout>N</success_on_timeout>
      <clear_result_rows>Y</clear_result_rows>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>250</xloc>
      <yloc>50</yloc>
      </entry>
    <entry>
      <name>Run product dimension update</name>
      <description>Job</description>
      <type>JOB</type>
      <specification_method>filename</specification_method>
      <job_object_id/>
      <filename>&#47;etl&#47;dimensions&#47;product_version_management.kjb</filename>
      <jobname/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <set_logfile>Y</set_logfile>
      <logfile>&#47;etl&#47;logs&#47;eod_dimensions</logfile>
      <logext>log</logext>
      <add_date>Y</add_date>
      <add_time>Y</add_time>
      <loglevel>Minimal</loglevel>
      <slave_server_name/>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <pass_export>N</pass_export>
      <parameters>        <pass_all_parameters>Y</pass_all_parameters>
            <parameter>            <name>mode</name>
            <stream_name/>
            <value>update</value>
            </parameter>      </parameters>      <set_append_logfile>N</set_append_logfile>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>450</xloc>
      <yloc>50</yloc>
      </entry>
    <entry>
      <name>Advance epoch</name>
      <description>SQL</description>
      <type>SQL</type>
      <sql>SELECT ADVANCE_EPOCH();</sql>
      <useVariableSubstitution>F</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename/>
      <sendOneStatement>F</sendOneStatement>
      <connection>metrics</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>750</xloc>
      <yloc>50</yloc>
      </entry>
    <entry>
      <name>Get dates</name>
      <description>Transformation</description>
      <type>TRANS</type>
      <specification_method>filename</specification_method>
      <trans_object_id/>
      <filename>${Internal.Job.Filename.Directory}&#47;get_dates.ktr</filename>
      <transname/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <clear_rows>N</clear_rows>
      <clear_files>N</clear_files>
      <set_logfile>N</set_logfile>
      <logfile/>
      <logext/>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <loglevel>Nothing</loglevel>
      <cluster>N</cluster>
      <slave_server_name/>
      <set_append_logfile>N</set_append_logfile>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <parameters>        <pass_all_parameters>Y</pass_all_parameters>
      </parameters>      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>50</xloc>
      <yloc>150</yloc>
      </entry>
    <entry>
      <name>Export to Socorro Staging</name>
      <description>Transformation</description>
      <type>TRANS</type>
      <specification_method>filename</specification_method>
      <trans_object_id/>
      <filename>&#47;etl&#47;socorro&#47;extract_adu.ktr</filename>
      <transname/>
      <arg_from_previous>N</arg_from_previous>
      <params_from_previous>N</params_from_previous>
      <exec_per_row>N</exec_per_row>
      <clear_rows>N</clear_rows>
      <clear_files>N</clear_files>
      <set_logfile>Y</set_logfile>
      <logfile>&#47;etl&#47;logs&#47;eod_socorro</logfile>
      <logext>log</logext>
      <add_date>Y</add_date>
      <add_time>Y</add_time>
      <loglevel>Minimal</loglevel>
      <cluster>N</cluster>
      <slave_server_name/>
      <set_append_logfile>N</set_append_logfile>
      <wait_until_finished>Y</wait_until_finished>
      <follow_abort_remote>N</follow_abort_remote>
      <create_parent_folder>N</create_parent_folder>
      <parameters>        <pass_all_parameters>Y</pass_all_parameters>
            <parameter>            <name>SOCORRO_DB_HOST</name>
            <stream_name/>
            <value>FIXME</value>
            </parameter>            <parameter>            <name>SOCORRO_DB_USER</name>
            <stream_name/>
            <value>FIXME</value>
            </parameter>            <parameter>            <name>SOCORRO_DB_PASS</name>
            <stream_name/>
            <value>FIXME</value>
            </parameter>            <parameter>            <name>DATE</name>
            <stream_name/>
            <value>= &apos;${PREVIOUS_UTC_DATE}&apos;</value>
            </parameter>      </parameters>      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>850</xloc>
      <yloc>250</yloc>
      </entry>
    <entry>
      <name>Guard for race</name>
      <description>Evaluate rows number in a table</description>
      <type>EVAL_TABLE_CONTENT</type>
      <connection>metrics mysql</connection>
      <schemaname/>
      <tablename/>
      <success_condition>rows_count_equal</success_condition>
      <limit>0</limit>
      <is_custom_sql>Y</is_custom_sql>
      <is_usevars>Y</is_usevars>
      <custom_sql>SELECT DISTINCT
  s.datacenter
, s.site
, s.server
, timestamp
FROM server_timestamps_to_process sttp
JOIN servers s ON sttp.site = s.site AND sttp.server = s.server
WHERE active = &apos;Y&apos; AND timestamp &lt;= &apos;${EOD_LAST_HOUR}&apos;
ORDER BY 1,2,3,4</custom_sql>
      <add_rows_result>N</add_rows_result>
      <clear_result_rows>Y</clear_result_rows>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>350</xloc>
      <yloc>50</yloc>
      </entry>
    <entry>
      <name>Wait for no required</name>
      <description>Wait for SQL</description>
      <type>WAIT_FOR_SQL</type>
      <connection>metrics mysql</connection>
      <schemaname/>
      <tablename/>
      <success_condition>rows_count_equal</success_condition>
      <rows_count_value>0</rows_count_value>
      <is_custom_sql>Y</is_custom_sql>
      <is_usevars>Y</is_usevars>
      <custom_sql>SELECT DISTINCT
  s.datacenter
, s.site
, s.server
, timestamp
FROM server_timestamps_to_process sttp
JOIN servers s ON sttp.site = s.site AND sttp.server = s.server
WHERE active = &apos;Y&apos; AND timestamp &lt;= &apos;${EOD_LAST_HOUR}&apos;
ORDER BY 1,2,3,4</custom_sql>
      <add_rows_result>N</add_rows_result>
      <maximum_timeout>2700</maximum_timeout>
      <check_cycle_time>300</check_cycle_time>
      <success_on_timeout>N</success_on_timeout>
      <clear_result_rows>Y</clear_result_rows>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>1</nr>
      <xloc>350</xloc>
      <yloc>200</yloc>
      </entry>
    <entry>
      <name>Mail missing logs</name>
      <description>Mail</description>
      <type>MAIL</type>
      <server>localhost</server>
      <port>25</port>
      <destination>metrics-alerts@mozilla.org</destination>
      <destinationCc/>
      <destinationBCc/>
      <replyto>metrics-alerts@mozilla.org</replyto>
      <replytoname>Metrics EOD processor</replytoname>
      <subject>Missing logs alert</subject>
      <include_date>N</include_date>
      <contact_person>Daniel Einspanjer</contact_person>
      <contact_phone>(603) 438-5731</contact_phone>
      <comment>The ETL processor was unable to find log files with valid data for the following servers and times.
Please check log file synchronization processes.  The processor will pick up new files on the next run.

These missing logs are currently preventing the End Of Day processing from succeeding.
This will delay the nightly reports and the exports of data to the Socorro and AMO production sites.


</comment>
      <include_files>N</include_files>
      <zip_files>N</zip_files>
      <zip_name/>
      <use_auth>N</use_auth>
      <use_secure_auth>N</use_secure_auth>
      <auth_user/>
      <auth_password>Encrypted </auth_password>
      <only_comment>Y</only_comment>
      <use_HTML>N</use_HTML>
      <use_Priority>Y</use_Priority>
      <encoding>UTF-8</encoding>
      <priority>high</priority>
      <importance>high</importance>
      <secureconnectiontype>SSL</secureconnectiontype>
      <replyToAddresses/>
      <filetypes>        <filetype>WARNING</filetype>
      </filetypes>      <embeddedimages>
      </embeddedimages>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>1</nr>
      <xloc>350</xloc>
      <yloc>250</yloc>
      </entry>
    <entry>
      <name>Mail export error</name>
      <description>Mail</description>
      <type>MAIL</type>
      <server>localhost</server>
      <port>25</port>
      <destination>metrics-alerts@mozilla.org</destination>
      <destinationCc/>
      <destinationBCc/>
      <replyto>metrics-alerts@mozilla.org</replyto>
      <replytoname>Metrics EOD processor</replytoname>
      <subject>Error during EOD processing</subject>
      <include_date>N</include_date>
      <contact_person>Daniel Einspanjer</contact_person>
      <contact_phone>(603) 438-5731</contact_phone>
      <comment>One of the EOD export scripts returned an error status.
Please check the logs and fix the problem then re-run relevant export script manually.

This will delay the nightly exports of data to the Socorro and AMO production sites.
</comment>
      <include_files>Y</include_files>
      <zip_files>Y</zip_files>
      <zip_name>run_logs.zip</zip_name>
      <use_auth>N</use_auth>
      <use_secure_auth>N</use_secure_auth>
      <auth_user/>
      <auth_password>Encrypted </auth_password>
      <only_comment>Y</only_comment>
      <use_HTML>N</use_HTML>
      <use_Priority>Y</use_Priority>
      <encoding>UTF-8</encoding>
      <priority>high</priority>
      <importance>high</importance>
      <secureconnectiontype>SSL</secureconnectiontype>
      <replyToAddresses/>
      <filetypes>        <filetype>LOG</filetype>
      </filetypes>      <embeddedimages>
      </embeddedimages>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>750</xloc>
      <yloc>250</yloc>
      </entry>
  </entries>
  <hops>
    <hop>
      <from>Run Vertica GAH</from>
      <to>Mail error condition</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>N</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Set Failed flag for EOD</from>
      <to>Abort if error</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>Y</unconditional>
    </hop>
    <hop>
      <from>Mail error condition</from>
      <to>Set Failed flag for EOD</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>Y</unconditional>
    </hop>
    <hop>
      <from>Already has successful eod?</from>
      <to>Set Running flag for EOD</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>N</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Already has successful eod?</from>
      <to>Success 1</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Set Running flag for EOD</from>
      <to>audit_server_traffic</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Run daily aggregates</from>
      <to>Mail error condition</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>N</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Run dimension update</from>
      <to>Mail error condition</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>N</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Set Successful flag for EOD</from>
      <to>Mail success</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>Y</unconditional>
    </hop>
    <hop>
      <from>Wait for no required</from>
      <to>Mail missing logs</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>N</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>audit_server_traffic</from>
      <to>Mail error condition</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>N</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Set Running flag for EOD</from>
      <to>Mail error condition</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>N</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>audit_server_traffic</from>
      <to>Wait for no required</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Run product dimension update</from>
      <to>Run dimension update</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Run product dimension update</from>
      <to>Mail error condition</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>N</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Run dimension update</from>
      <to>Run daily aggregates</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Run daily aggregates</from>
      <to>Advance epoch</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Advance epoch</from>
      <to>Run Vertica GAH</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>START</from>
      <to>Get dates</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>Y</unconditional>
    </hop>
    <hop>
      <from>Get dates</from>
      <to>Already has successful eod?</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Wait for no required</from>
      <to>Guard for race</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Guard for race</from>
      <to>Run product dimension update</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Mail missing logs</from>
      <to>Wait for no required</to>
      <from_nr>0</from_nr>
      <to_nr>1</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>Y</unconditional>
    </hop>
    <hop>
      <from>Wait for no required</from>
      <to>Mail missing logs</to>
      <from_nr>1</from_nr>
      <to_nr>1</to_nr>
      <enabled>Y</enabled>
      <evaluation>N</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Wait for no required</from>
      <to>Guard for race</to>
      <from_nr>1</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Mail missing logs</from>
      <to>Set Failed flag for EOD</to>
      <from_nr>1</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>Y</unconditional>
    </hop>
    <hop>
      <from>Run Vertica GAH</from>
      <to>export_daily_amo_stats</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>export_daily_amo_stats</from>
      <to>Export to Socorro</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Export to Socorro</from>
      <to>Export to Socorro Staging</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>export_daily_amo_stats</from>
      <to>Mail export error</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>N</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Export to Socorro</from>
      <to>Mail export error</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>N</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Export to Socorro Staging</from>
      <to>Mail export error</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>N</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>Run Vertica GAH</from>
      <to>Set Successful flag for EOD</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
  </hops>
  <notepads>
  </notepads>
</job>
